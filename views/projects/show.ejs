<link rel="stylesheet" type="text/css" href="/assets/css/project_float.css">
<link rel="stylesheet" type="text/css" href="/assets/css/swiper.min.css">

<script type="text/javascript" src="/assets/js/swiper.min.js"></script>
<script type="text/javascript" src="/assets/js/gallery_all.js"></script>
<link rel="stylesheet" type="text/css" href="/assets/css/gallery.css">

<div class="dark_mask"></div>
	<div id="detail_left">
		<div class="class_icons">
			<div class="float_icon culture"></div>
			<div class="float_icon digital"></div>
			<div class="float_icon social"></div>
		</div>
		<div id="detail_brief">
			<a href="/uploads/project/<%= project._id %>/logo.png?<%= new Date().getTime() %>" class="brief_pic progressive replace auto_adjust not_yet">
			  <img src="/uploads/project/<%= project._id %>/logo_tiny.png?<%= new Date().getTime() %>" class="preview" alt="test"/>
			</a>
			<!-- <div class="brief_pic">
        <% if(project.hasCover == 1){ %>
        <img id="project_pic" src="/uploads/project/<%= project._id %>/logo.png?<%= new Date().getTime() %>">
        <% }else{ %>
        <img id="project_pic" src="/assets/images/project_ex2.png">
        <% } %>
        <img id="pic_more" src="/assets/images/pic_more.png">
			</div> -->
			<p class="project_name">
        <% for(var i = 0; i < project.BigTitle.length; i++){ %>
          <%= project.BigTitle[i] %>
          <br>
        <% } %>   
      </p>
		</div>
	</div>
	<div class="with_scroll" id="detail_right">
		<p id="detail_main_text">
      <% for(var i = 0; i < project.SmallTitle.length; i++){ %>
        <%= project.SmallTitle[i] %>
        <br>
      <% } %>     
    </p>
		<p>　</p>
		<p id="detail_type">
      <p class="title">Type</p>
      <span>/</span>
      <p class="short orange"><%= project.Type %></p>
    </p>
    <p id="detail_location">
      <p class="title">Location</p><span>/</span>
      <p class="short"><%= project.Location %></p>
      <div class="botton tiny" onclick="window.open('https://www.google.com.tw/maps/search/<%= project.Location %>')">MAP</div>
    </p>
		<p id="detail_duration">
			<p class="title">duration</p><span>/</span>
			<p class="short">
        <% if(project.Time[1] == 'undefined' ){ %>
          <%= new Date(Number(project.Time[0])).getMonth() + 1 %>
          /
          <%= new Date(Number(project.Time[0])).getDate() %>
        <% }else{ %> 
            <%= new Date(Number(project.Time[0])).getMonth() + 1 %>
            /
            <%= new Date(Number(project.Time[0])).getDate() %>
            -
            <%= new Date(Number(project.Time[1])).getMonth() + 1 %>
            /
            <%= new Date(Number(project.Time[1])).getDate() %>
        <% } %>
			</p>
		</p>
		<p id="detail_need">
      <p class="title">Need</p>
      <span>/</span>
      <p class="short">
        <% for(var i =0 ; i < project.Need.length  ;i ++){ %>
          <%= project.Need[i] %>
        <% } %>
      </p>
    </p>
		<p id="detail_intro">
      <p class="title with_space">Introduction</p>
      <span>/</span>
      <p class="long"><%- project.Introduction.replace(/\r\n/g, '<br/>') %>
      </p>
    </p>
		<p id="detail_mission">
      <p class="title with_space">Goal</p>
      <span>/</span>
      <p class="long">
        <%= project.Mission %>
			</p>
    </p>
 		<p id="detail_contributer"><br/>
      <p class="title">Contributor</p>
      <span>/</span>
      <p class="short"></p>
    </p>
		<p id="detail_sponsor">
      <p class="title">Sponsor</p>
      <span>/</span>
      <p class="short"></p>
    </p>
		<p id="detail_activities">
      <p class="title">Activities</p>
      <span>/</span>
      <p class="short"></p>
    </p>
		<p id="detail_teammate">
      <p class="title">Teammate</p>
      <span>/</span>
      <p class="short">
        <br>
        <% for(var i in members){ %>
          <a class="openInfo" type="users" id="<%= members[i]._id %>"><%= members[i].Name %></a>
          <% if(i != members.length - 1) {%> , <% } %>
        <% } %>
      </p>
    </p>
	</div>
  <% if(me) {%>
    <% if(me.Role >= 1){ %>
    	<div class="bottom_icons">
        <% if(me){ %>
          <% if(project.ApplyID.indexOf(me._id)==-1 && project.MemberID.indexOf(me._id)==-1){ %>
            <div class="round_icon join joinProject" project-id="<%= project._id %>"></div>
          <% }else if(project.ApplyID.indexOf(me._id)!=-1 || project.MemberID.indexOf(me._id)!=-1){ %>
            <!-- <div class="ui red button quitProject" project-id="<%= project._id %>">
              Quit
            </div> -->
          <% } %>
        <% } %>
        <div class="round_icon interest"></div>
    		<div class="round_icon share"></div>
    		<div class="round_icon text"></div>
    	</div>
    <% } %>
  <% } %>
	<a href="#" class="close_icon" id="close_window"></a>
  <div class="float_pic_window">
		<div class="gallery" style="background: transparent;">
			<div class="swiper-container">
				<div class="swiper-wrapper">
						<div class="swiper-slide">
							<div class="auto_adjust not_yet in_swiper">
								<img onclick="window.open('/uploads/project/<%= project._id %>/logo.png?<%= new Date().getTime() %>')" src="/uploads/project/<%= project._id %>/logo.png?<%= new Date().getTime() %>">
							</div>
						</div>
				    <% for(var i = 0; i < project.Photo.length; i++) { %>
							<div class="swiper-slide">
								<div class="auto_adjust not_yet in_swiper">
									<img onclick="window.open('<%= project.Photo[i] %>?<%= new Date().getTime() %>')" src="<%= project.Photo[i] %>?<%= new Date().getTime() %>">
								</div>
							</div>
				    <% } %>
				</div>
				<div class="swiper-pagination"></div>
				<div class="swiper-button-prev"></div>
				<div class="swiper-button-next"></div>
			</div>
			<div class="close_icon" id="close_window"></div>
		</div>
    <!-- <a href="#" class="close_icon" id="close_pic_view">　</a> -->
  </div>

<script>
$(document).ready(function(){
	// loading圖片
	restartProgressiveLoading();

  $('.joinProject').on('click', function(){
    var id = this.getAttribute('project-id');
    $.ajax({
      url: "/projects/join/",
      type: "POST",
      data:{
        project_id:id
      },
      success: function(response) {
        toastr.success("申請成功");
        setTimeout(function(){
          window.location.href = window.location.href;
        },3000);
      }
    });
  });

  $('.quitProject').on('click', function(){
    var id = this.getAttribute('project-id');
    $.ajax({
      url: "/projects/quit/",
      type: "POST",
      data:{
        project_id:id
      },
      success: function(response) {
        toastr.success("退出成功");
        setTimeout(function(){
          window.location.href = window.location.href;
        },3000);
      }
    });
  });

  $('.delProject').on('click', function(){
    var id = this.getAttribute('project-id');
    $.ajax({
      url: "/projects/delete/"+id,
      type: "DELETE",
      success: function(response) {
        if(response=="ok"){
          toastr.success("刪除成功");
          setTimeout(function(){
            window.location.href = window.location.href;
          },3000);
        }
      }
    });
  });
});
</script>
